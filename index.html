<html>
	<head>
		<script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
		<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.misc.min.js"></script>
		<script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
		<!--<script src="https://raw.github.com/mrdoob/three.js/master/build/three.min.js">-->
		<script>
			AFRAME.registerComponent('modify-materials', {
				init: function () {
					const filepath = "FITCICubebright/";

					this.texture = new THREE.CubeTextureLoader().load([
						filepath + 'posx.png', filepath + 'negx.png',
						filepath + 'posy.png', filepath + 'negy.png',
						filepath + 'posz.png', filepath + 'negz.png'
					]);
					this.texture.format = THREE['RGBFormat'];

					const envMap = this.texture;

					// Wait for model to load.
					this.el.addEventListener('model-loaded', () => {
						// Grab the mesh / scene.
						const obj = this.el.getObject3D('mesh');
						// Go over the submeshes and modify materials we want.
						obj.traverse(node => {
							console.log("Looking by name 060...");
							if (node.isMesh) {
								if (node.material && 'envMap' in node.material) {
									console.log("Found envMap in mesh");
									node.material.roughness = 0;
									node.material.envMap = envMap;
									node.material.needsUpdate = true;
									console.log("Set envMap with DM code");
								}
							}
						});
					});
				}
			});
		</script>
	</head>
	<body>
		<a-scene stats background="color: black">
			<a-assets>
				<!--<img id="boxTexture" src="https://i.imgur.com/mYmmbrp.jpg">-->
				<a-asset-item id="testplate" src="SpinningPlate_002.glb"></a-asset-item>
				<a-asset-item id="testplate_003" src="SpinningPlate_003.glb"></a-asset-item>
				<a-asset-item id="testplateOBJ" src="objPlate/OBJPlate_rot.obj"></a-asset-item>
				<img id="plateColor" src="objPlate/StripedMetalColor.jpg"></img>
				<img id="plateMet" src="objPlate/StripedMetalMet.jpg"></img>
				<img id="plateNormal" src="objPlate/StripedMetalNormal.jpg"></img>
				<img id="plateRough" src="objPlate/StripedMetalRough.jpg"></img>
				
				<img id="sky" src="FITCIHDRI.png">
				<a-cubemap id="FITCICube">
					<img src="FITCICube/posx.png">
					<img src="FITCICube/negx.png">
					<img src="FITCICube/posy.png">
					<img src="FITCICube/negy.png">
					<img src="FITCICube/posz.png">
					<img src="FITCICube/negz.png">
				</a-cubemap>
			</a-assets>

		  	<a-entity position="0 0 3" rotation="0 0 0">
				<a-camera></a-camera>
				</a-entity>
			
			<a-sky src="#sky"></a-sky>	

			<a-entity id="Plate"
				gltf-model="#testplate"
				position="-1 1.3 0"
				modify-materials>
				</a-entity>
	
			<a-entity id="Plate2"
				gltf-model="#testplate_003"
				position="3 1.3 0"
				modify-materials>
				</a-entity>
		
			<a-obj-model
			     	src="#testplateOBJ"
			     	material="shader: standard;
					  src: #plateColor;
					  metalnessMap: #plateMet;
					  metalness: 1;
					  envMap: #FITCICube;
					  roughnessMap: #plateRough;
					  roughness: 0;
					  normalMap: #plateNormal"
			     	position="1 1.3 0">
				</a-obj-model>

			<!--<a-entity id="Box1"
				geometry="primitive: box"
				position="1 1.3 -3"
				material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
				</a-entity>

			<a-entity id="Box2"
				geometry="primitive: box"
				position="3 1.3 0"
				material="color: #ccffff; metalness: 1; envMap: #FITCICube; roughness: 0.1">
				</a-entity>

			<a-entity id="Box3"
				geometry="primitive: box"
				position="1 1.3 0"
				material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
				</a-entity>-->

			<a-entity id="Box4"
				geometry="primitive: sphere"
				position="-3 1.3 0"
				material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
				</a-entity>

			<!--<a-entity environment="preset: forest; dressingAmount: 500"></a-entity>-->

			<!--<a-light type="ambient" color="#ffffff" intensity="0"></a-light>-->
			<!--<a-light yellower type="directional" color="#ffffff" intensity="3" position="-1 10 6"></a-light>
			<a-light bluer type="directional" color="#fff8ff" intensity="1.5" position="1 0 -0.5"></a-light>
			<a-entity light="type: directional; color: #e1e3e4; intensity: 2" position="0 -1 0"></a-entity>-->
		</a-scene>

		<script> console.log(THREE); </script>
	</body>
</html>
