<html>
  <head>
    <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
	<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.misc.min.js"></script>
	<script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
	<!--<script src="https://raw.github.com/mrdoob/three.js/master/build/three.min.js">-->
	<script>
      		AFRAME.registerComponent('modify-materials', {
        		init: function () {
				const filepath = "FITCICubebright/";

				this.texture = new THREE.CubeTextureLoader().load([
			      		filepath + 'posx.png', filepath + 'negx.png',
			      		filepath + 'posy.png', filepath + 'negy.png',
			      		filepath + 'posz.png', filepath + 'negz.png'
			    	]);
			    	this.texture.format = THREE['RGBFormat'];
				
				const envMap = this.texture;
				
         		 	// Wait for model to load.
          			this.el.addEventListener('model-loaded', () => {
					// Grab the mesh / scene.
					const obj = this.el.getObject3D('mesh');
           				// Go over the submeshes and modify materials we want.
            				obj.traverse(node => {
						console.log("Looking by name 038...");
						if (node.name !== -1) {
							console.log("Found Something");
							//node.material.color.set('green');
						}
						if (node.isMesh) {
							console.log("Found a mesh");
							if (node.material && 'envMap' in node.material) {
								console.log("Found envMap in mesh");
								node.material.envMap = envMap;
        							node.material.needsUpdate = true;
								console.log("Set envMap with DM code");
							}
						}
						if (node.name == 'GlTF_Test') {
							//console.log("Found It By Name... Setting Env Map");
							//node.material.emissive.set('#992299');
							//node.material.metalness = 0;
							//node.material.sphericalEnvMap.set('FITCIHDRI.png');
							//console.log("Successfully set EnvMap..?");
						}
						/**if (node.name.indexOf('GlTF_Test') !== -1) {
							console.log("Found It by IndexOf");
							node.material.color.set('green');
						}*/
            				});
         			 });
       			 }
      		});
    	</script>
  </head>
  <body>
	
  
    <a-scene stats background="color: black">
		<a-assets>
			<!--<img id="boxTexture" src="https://i.imgur.com/mYmmbrp.jpg">-->
			<a-asset-item id="testplate" src="SpinningPlate_002.glb"></a-asset-item>
			<img id="sky" src="FITCIHDRI.png">
			<a-cubemap id="FITCICube">
				<img src="FITCICube/posx.png">
				<img src="FITCICube/negx.png">
				<img src="FITCICube/posy.png">
				<img src="FITCICube/negy.png">
				<img src="FITCICube/posz.png">
				<img src="FITCICube/negz.png">
			</a-cubemap>
		</a-assets>
	    
	  <a-entity position="0 0 3" rotation="0 0 0">
			<a-camera></a-camera>
		</a-entity>
	
	
		
    		
		<a-sky src="#sky"></a-sky>	
	    
		<a-entity id="Plate"
			gltf-model="#testplate"
			position="-1 1.6 0"
			cube-env-map="path: FITCICubebright/; extension: png;"
			modify-materials>
			</a-entity>

		<a-entity id="Box1"
			geometry="primitive: box"
			position="1 1.6 -3"
			material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
			</a-entity>
			
		<a-entity id="Box2"
			geometry="primitive: box"
			position="3 1.6 0"
			material="color: #ccffff; metalness: 1; envMap: #FITCICube; roughness: 0.1">
			</a-entity>

		<a-entity id="Box3"
			geometry="primitive: box"
			position="1 1.6 0"
			material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
			</a-entity>

		<a-entity id="Box4"
			geometry="primitive: sphere"
			position="-3 1.6 0"
			material="color: #ffcccc; metalness: 1; envMap: #FITCICube; roughness: 0.1">
			</a-entity>
		
		<!--<a-entity environment="preset: forest; dressingAmount: 500"></a-entity>-->
		
		<a-light type="ambient" color="#20303f" intensity="1"></a-light>
		<a-light yellower type="directional" color="#ffffff" intensity="3" position="-1 10 6"></a-light>
		<!--<a-light bluer type="directional" color="#fff8ff" intensity="1.5" position="1 0 -0.5"></a-light>
		<a-entity light="type: directional; color: #e1e3e4; intensity: 2" position="0 -1 0"></a-entity>-->
    </a-scene>
	
	<script> console.log(THREE); </script>
  </body>
</html>
